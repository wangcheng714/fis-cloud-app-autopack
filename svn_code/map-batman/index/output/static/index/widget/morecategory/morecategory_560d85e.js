define("index:widget/morecategory/morecategory.js",function(e,t,r){MY_GEO="我的位置";var n=e("common:widget/geolocation/location.js"),a=e("common:widget/url/url.js").get();r.exports={init:function(){this.render(),this.bind()},render:function(){this.parentele=$(".categoryparent"),this.morecategory=$("#more-category"),this.childele=$(".categorychild h4")},bind:function(){var e=this;e.parentele.on("click",$.proxy(e._handleClickEvent,this)),e._setCenterName(),e.childele.on("click",$.proxy(e._redirect,this))},_redirect:function(e){var t=this.getUrl($(e.target).text()),r="/mobile/webapp/"+t.action+"/"+t.module+"/"+$.param(t.query)+"/"+$.param(t.pageState);location.href=r},_handleClickEvent:function(e){var t=this;e.target,t.toggleClickedLiIcon(e)},_setCenterName:function(){var e=a.pageState,t=a.query,r=(t.wd||"").split("     ");return"更多"===r[1]?(this.centerName=r[0],this.centerName):e.center_name?decodeURIComponent(e.center_name):n.hasExactPoi()?MY_GEO:n.getCity()},toggleClickedLiIcon:function(e){var t=this,r=$(e.target).parent();childli=r.next(".rl_sub_list"),"none"==childli.css("display")?(r.find("em").removeClass("rl_opt_close"),r.find("em").addClass("rl_opt_open"),$(".rl_sub_list").hide(),childli.show()):(r.find("em").removeClass("rl_opt_open"),r.find("em").addClass("rl_opt_close"),childli.hide()),t.currentLi=t.getCurrentLi(e.target),t._scrollToCurrentCategory()},_scrollToCurrentCategory:function(){var e=this,t=$(e.currentLi).offset();window.scroll(0,t.top)},getCurrentLi:function(e){var t=e;if("LI"!==t.nodeName)for(;null!=e.parentNode;){if("LI"===e.parentNode.nodeName){t=e.parentNode;break}e=e.parentNode}return t},getUrl:function(e){var t={module:"search",action:"search",query:{qt:"s",wd:this.centerName?e+" "+this.centerName:e,searchFlag:"more_cate",c:n.getCityCode()||1},pageState:{}};return t=this.setCenterPoi(t),this.centerName&&(delete t.query.nb_x,delete t.query.nb_y,delete t.query.center_rank,delete t.pageState.center_name),t},setCenterPoi:function(e){var t=e||{};t.query=t.query||{},t.pageState=t.pageState||{};var r=a.pageState,i=a.query;return r&&"searchnearby"==r.type||r&&"searchnearby"==r.from?(t.query.center_rank=1,t.query.nb_x=i.nb_x,t.query.nb_y=i.nb_y,t.pageState.center_name=r.center_name,t):(n.hasExactPoi()&&(t.query.center_rank=1,t.query.nb_x=n.getPointX(),t.query.nb_y=n.getPointY(),t.pageState.center_name=n.isUserInput()?n.getAddress():"我的位置"),t)}}});