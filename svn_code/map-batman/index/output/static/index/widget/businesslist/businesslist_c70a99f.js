define("index:widget/businesslist/businesslist.js",function(require,exports,module){var url=require("common:widget/url/url.js"),util=require("common:static/js/util.js"),searchData=require("common:static/js/searchdata.js"),_dataCache,_areaList={},cityData,BUSINESS_SPLIT="     ",dataPath="/mobile/?&from=maponline&tn=m01&ie=utf-8&data_version=11252019",saveData=function(e){e&&(addAreaItem(e.area_code,e),2==e.area_type&&(cityData=e),e.sub&&$.each(e.sub,function(e,a){addAreaItem(a.area_code,a)}))},addAreaItem=function(e,a){a&&e&&(_areaList[e]=a)},getAreaItem=function(e){return _areaList[e]},bind=function(){var e=$(".index-widget-bussinesslist");e.on("click",".top-title",toggleList),e.on("click","[jsaction]",eventHandler)},completeSelete=function(e){if(e){var a,t=getAreaItem(e),i=url.get(),s=(i.query||{},i.pageState||{}),n=util.urlToJSON(s.refer_query)||{},l=util.urlToJSON(s.refer_pagestate)||{},r={},o={},d=n.wd;r=$.extend({},r,l,{dist_name:t.area_name,keep_stay:1}),d&&d.indexOf(BUSINESS_SPLIT)>-1&&(d=d.split(BUSINESS_SPLIT)[1]),10==t.area_type?(d=t.area_name+BUSINESS_SPLIT+d,a=cityData.area_code):a=t.area_code,o=$.extend(o,n,{c:a,wd:d,pn:0}),delete o.nb_x,delete o.nb_y,delete o.center_rank,url.update({module:"place",action:"list",query:o,pageState:r})}},listSub=function(e,a){if(e&&a){a.data("loaded");var t="/?qt=sub_area_list&level=1&business_flag=1",i=a.next();1==a.data("loaded")?i.hasClass("hide")?(i.data("visible","1"),hideOther(),scrollToEle(a)):hideOther():(t+="&areacode="+e,searchData.fetch(t,function(e){var t=e.content;hideOther(),t&&(saveData(t),appendSubList(t,a))},function(){}))}},scrollToEle=function(e){if(e){var a=e.offset().top;window.scrollTo(0,a)}},hideOther=function(){$(".index-widget-bussinesslist .sub_list .sub_list").not("hide").each(function(e,a){1==$(a).data("visible")?$(a).removeClass("hide"):$(a).addClass("hide"),$(a).data("visible","0")})},appendSubList=function(data,ele){var tpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';eval(_template_varName),_template_fun_array.push('<li class="sub_list"><ul class="sub_wrapper"><li data-areacode = "',"undefined"==typeof area_code?"":area_code,'" jsaction="complete"><h4>全区</h4><span class="rl_opt"><em class="rl_opt_btn rl_opt_close"></em></span>               </li>');for(var i=0,l=sub.length;l>i;i++)_template_fun_array.push('<li data-areacode = "',"undefined"==typeof sub[i].area_code?"":sub[i].area_code,'" jsaction="complete"><h4>',"undefined"==typeof sub[i].area_name?"":sub[i].area_name,'</h4><span class="rl_opt"><em class="rl_opt_btn rl_opt_close"></em></span>               </li>');_template_fun_array.push("</ul></li>"),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0],html=tpl(data);$(html).insertAfter(ele),ele.data("loaded","1"),ele.data("visible","1"),scrollToEle(ele)},switchToList=function(e){var a,t,i,s,n=this;a=n.get("pagestate"),t=util.getReqParam(a.refer_query)||{},s=util.getReqParam(a.refer_pagestate)||{},s=$.extend(s,{dist_name:e.isBusiness?"":e.name,keep_stay:1});var l=t.wd.split(mapConst.BUSINESS_SPLIT);l=l[1]?l[1]:t.wd,i={wd:e.isBusiness?e.name+"     "+l:l,c:e.isBusiness?e.cityCode:e.subCode,pn:0},$.extend(t,i),app.updateHash({module:"place",action:"list",query:t,pageState:s},{trigger:!0,queryReplace:!0,pageStateReplace:!0})},toggleList=function(){var e=$(this);e.next().toggleClass("hide")},eventHandler=function(){var e=$(this),a=e.data("areacode"),t=e.attr("jsaction"),i={complete:completeSelete,listsub:listSub},s=i[t];$.isFunction(s)&&s(a,e)};module.exports.init=function(e){saveData(e),bind()}});