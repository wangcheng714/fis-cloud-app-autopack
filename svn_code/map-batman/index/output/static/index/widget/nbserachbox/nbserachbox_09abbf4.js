define("index:widget/nbserachbox/nbserachbox.js",function(e,t,r){MY_GEO="我的位置";var n=e("common:widget/geolocation/location.js"),a=e("common:widget/url/url.js").get(),i=e("common:widget/stat/stat.js");r.exports={init:function(){this.render(),this.bind()},render:function(){this.searchmorenearby=$("#index-widget-nbserachbox"),this.searchInput=$("#search-input"),this.DEFAULT_VALUE="输入其他分类",this.searchBtn=$("#search-button"),this.searcForm=$("#search-form")},bind:function(){var e=this;e._renderCenterName(),e.searchInput.on("focus",$.proxy(e._clearInput,this)),e.searchInput.on("blur",$.proxy(e._resetInput,this)),e.searcForm.on("submit",$.proxy(e._searchPoint,this)),e.searchBtn.on("click",$.proxy(e._searchPoint,this))},_renderCenterName:function(){var e=this._getCenterName();me=this,me.searchmorenearby.prepend('<p id="search-more-nearby">在 <span class="center-name">'+e+"</span> 附近找</p>")},_getCenterName:function(){var e=a.pageState,t=a.query,r=(t.wd||"").split("     ");return"更多"===r[1]?(this.centerName=r[0],this.centerName):e.center_name?e.center_name:n.hasExactPoi()?MY_GEO:n.getCity()},_clearInput:function(e){var t=this,r=$(e.target);r.val()===t.DEFAULT_VALUE&&(r.val(""),r.removeClass("ipt-default"))},_resetInput:function(e){var t=this,r=$(e.target),n=r.val();""===$.trim(n)&&(r.val(t.DEFAULT_VALUE),r.addClass("ipt-default"))},_searchPoint:function(e){e&&e.stopPropagation&&e.stopPropagation(),e&&e.preventDefault&&e.preventDefault();var t=this,r=$("#search-input"),n=r.val();return r.get(0).blur(),t._checkValueValid(n)?(t.search($.trim(n)),!1):void 0},_checkValueValid:function(e){return""!==$.trim(e)&&$.trim(e)!==this.DEFAULT_VALUE?!0:!1},search:function(e){"more"==a.action&&i.addStat(STAT_CODE.STAT_MORE_CATEGORY_SEARCH_INPUT);var t=this,r=t._getDirParam($.trim(e));location.href="/mobile/webapp/search/search/"+$.param(r)},_getDirParam:function(e,t){if(e&&"string"==typeof e){t=t||{};var r={qt:"s",wd:this.centerName?e+" "+this.centerName:e,c:n.getCityCode()||1,searchFlag:t.from||""},i=a.pageState;return i.nb_x&&i.nb_x?(r.nb_x=i.nb_x,r.nb_y=i.nb_y,r.center_rank=1,r.center_name=i.center_name):n.hasExactPoi()&&(r.nb_x=n.getPointX(),r.nb_y=n.getPointY(),r.center_rank=1),r.searchFlag="more_cate",r}}}});