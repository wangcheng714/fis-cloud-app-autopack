define("third:widget/nearpush/cater.js",function(require,exports,module){var util=require("common:static/js/util.js"),url=require("common:widget/url/url.js"),stat=require("common:widget/stat/stat.js"),searchData=require("common:static/js/searchdata.js"),broadcaster=require("common:widget/broadcaster/broadcaster.js"),locator=require("common:widget/geolocation/location.js"),geolocator=require("common:widget/geolocation/geolocation.js"),helper=require("index:widget/helper/helper.js"),id="cater",tpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push(""),data&&data.length>0){_template_fun_array.push('    <div class="hd">        <a href="javascript:void(0);" jsaction="cater-all" userdata="{&#39;wd&#39;:&#39;',"undefined"==typeof word?"":word,"&#39;,&#39;id&#39;:&#39;","undefined"==typeof id?"":id,'&#39;}">            查看全部        </a>        <h2>美食</h2>    </div>    <ul class="list">        ');for(var i=0,l=data.length;3>i;i++)_template_fun_array.push('            <li jsaction="cater-detail" userdata="{&#39;uid&#39;:&#39;',"undefined"==typeof data[i].uid?"":data[i].uid,"&#39;,&#39;id&#39;:&#39;","undefined"==typeof id?"":id,'&#39;}">                <a class="a-img" href="javascript:void(0);">                    <img width="89" height="66" src="',"undefined"==typeof data[i].image?"":data[i].image,'">                    ',"undefined"==typeof data[i].otherflag?"":data[i].otherflag,'                </a>                <dl>                    <dt class="name">',"undefined"==typeof data[i].name?"":data[i].name,'</dt>                    <dd class="rate">',"undefined"==typeof data[i].star?"":data[i].star,'</dd>                    <dd class="cmt">                        <span class="count">',"undefined"==typeof data[i].comment?"":data[i].comment,'</span>                        <span class="tail">条评论</span>                    </dd>                </dl>            </li>        ');if(_template_fun_array.push("    </ul>    "),"hao123"==page){_template_fun_array.push('        <ul class="list">            ');for(var i=3,l=data.length;6>i;i++)_template_fun_array.push('                <li jsaction="cater-detail" userdata="{&#39;uid&#39;:&#39;',"undefined"==typeof data[i].uid?"":data[i].uid,"&#39;,&#39;id&#39;:&#39;","undefined"==typeof id?"":id,'&#39;}">                    <a class="a-img" href="javascript:void(0);">                        <img width="89" height="66" src="',"undefined"==typeof data[i].image?"":data[i].image,'">                        ',"undefined"==typeof data[i].otherflag?"":data[i].otherflag,'                    </a>                    <dl>                        <dt class="name">',"undefined"==typeof data[i].name?"":data[i].name,'</dt>                        <dd class="rate">',"undefined"==typeof data[i].star?"":data[i].star,'</dd>                        <dd class="cmt">                            <span class="count">',"undefined"==typeof data[i].comment?"":data[i].comment,'</span>                            <span class="tail">条评论</span>                        </dd>                    </dl>                </li>            ');_template_fun_array.push("        </ul>    ")}_template_fun_array.push("")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];module.exports={hasGetData:!1,firstShow:!1,init:function(a){this.page=a,this.bind()},bind:function(){switch(broadcaster.subscribe("nearpush.dataready",function(){this._render(helper.cates[id].data)},this),this.page){case"business":this._businessAction();break;case"index":this._indexAction();break;default:this._defaultAction()}},_defaultAction:function(){this._bindGeoEvent()},_businessAction:function(){this._fetch()},_indexAction:function(){helper.visible(".index-widget-cater",function(){this.hasGetData||(this._fetch(),this._bindGeoEvent())},this)},_bindGeoEvent:function(){broadcaster.subscribe("geolocation.success",this._fetch,this),broadcaster.subscribe("geolocation.fail",function(){},this)},_fetch:function(){var a=this,e=$(".index-widget-cater");$(".index-page-nearby-hd"),1!=locator.getCityCode()&&(e.css("min-height","160px"),util.showLoading(e)),helper.getData(id,function(){helper.ready()},{page:a.page}),this.hasGetData=!0},_render:function(a){var e=this,t=helper.cates[id].wd,i=$(".index-widget-cater"),d=$(".index-page-nearby-hd");a&&a.length>0?(i.html(tpl({data:a,id:id,word:t,page:e.page})),d.show(),e.firstShow||(stat.addStat(STAT_CODE.STAT_NEARPUSH_SHOW),e.firstShow=!0)):(i.css("min-height","0"),"index"==this.page&&d.hide()),util.hideLoading(i),this._bind()},_bind:function(){$(".index-widget-cater [jsaction]").on("click",this.jump)},jump:function(a){helper.go(a,id)}}});