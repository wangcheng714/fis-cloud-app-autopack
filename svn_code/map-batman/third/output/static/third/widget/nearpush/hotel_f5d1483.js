define("third:widget/nearpush/hotel.js",function(require,exports,module){var util=require("common:static/js/util.js"),url=require("common:widget/url/url.js"),searchData=require("common:static/js/searchdata.js"),broadcaster=require("common:widget/broadcaster/broadcaster.js"),locator=require("common:widget/geolocation/location.js"),geolocator=require("common:widget/geolocation/geolocation.js"),helper=require("index:widget/helper/helper.js"),id="hotel",tpl=[function(_template_object){var _template_fun_array=[],fn=function(__data__){var _template_varName="";for(var name in __data__)_template_varName+="var "+name+'=__data__["'+name+'"];';if(eval(_template_varName),_template_fun_array.push(""),data&&data.length>0){_template_fun_array.push('    <div class="hd">        <a href="javascript:void(0);" jsaction="hotel-all" userdata="{&#39;wd&#39;:&#39;',"undefined"==typeof word?"":word,"&#39;,&#39;id&#39;:&#39;","undefined"==typeof id?"":id,'&#39;}">            查看全部        </a>        <h2>酒店</h2>    </div>    <ul class="list">        ');for(var i=0,l=data.length;l>i;i++){_template_fun_array.push("            ");var item=data[i];_template_fun_array.push('            <li jsaction="hotel-detail" userdata="{&#39;uid&#39;:&#39;',"undefined"==typeof item.uid?"":item.uid,"&#39;,&#39;id&#39;:&#39;","undefined"==typeof id?"":id,'&#39;}">                <div class="clearfix">                    <a class="a-img" href="javascript:void(0);">                        <img width="89" height="66" src="',"undefined"==typeof item.image?"":item.image,'">                        ',"undefined"==typeof item.otherflag?"":item.otherflag,'                    </a>                    <dl>                        <dt class="name">',"undefined"==typeof item.name?"":item.name,'</dt>                        <dd class="addr">地址：',"undefined"==typeof item.addr?"":item.addr,'</dd>                        <dd class="cmt">                            <span class="rate">',"undefined"==typeof item.star?"":item.star,'</span>                            <span class="price">                                <span class="tail">人均：</span>                                <span class="count">￥',"undefined"==typeof item.price?"":item.price,'</span>                            </span>                        </dd>                    </dl>                </div>                <div class="bar clearfix">                        '),item.tel.num?_template_fun_array.push('                            <div class="btn tel">                                <a class="a-tel" ',"undefined"==typeof item.tel.url?"":item.tel.url,'>                                    <b class="icon tel"></b>',"undefined"==typeof item.tel.num?"":item.tel.num,"                                </a>                            </div>                            "):_template_fun_array.push('                            <div class="btn tel" style="visibility:hidden">                                <a class="a-tel" href="/">                                    <b class="icon tel"></b>000-00000000                                </a>                            </div>                              '),_template_fun_array.push("                    "),item.order&&_template_fun_array.push('                        <div class="btn order"><a href="javascript:void(0);" jsaction="hotel-detail" userdata="{&#39;uid&#39;:&#39;',"undefined"==typeof item.uid?"":item.uid,'&#39;}">预订</a></div>                    '),_template_fun_array.push("                </div>            </li>        ")}_template_fun_array.push("    </ul>")}_template_fun_array.push(""),_template_varName=null}(_template_object);return fn=null,_template_fun_array.join("")}][0];module.exports={hasGetData:!1,init:function(e){this.page=e,this.bind()},bind:function(){switch(broadcaster.subscribe("nearpush.dataready",function(){this._render(helper.cates[id].data)},this),this.page){case"business":this._businessAction();break;case"index":this._indexAction();break;default:this._defaultAction()}},_defaultAction:function(){this._bindGeoEvent()},_businessAction:function(){this._fetch()},_indexAction:function(){helper.visible(".index-widget-hotel",function(){this.hasGetData||(this._fetch(),this._bindGeoEvent())},this)},_bindGeoEvent:function(){broadcaster.subscribe("geolocation.success",this._fetch,this),broadcaster.subscribe("geolocation.fail",function(){},this)},_fetch:function(){var e=this;this.hasGetData=!0,helper.getData(id,function(){helper.ready()},{page:e.page})},_render:function(e){var t=this,a=helper.cates[id].wd;e&&e.length>0&&$(".index-widget-hotel").html(tpl({data:e,id:id,word:a,page:t.page})),this._bind()},_bind:function(){$(".index-widget-hotel [jsaction]").on("click",this.jump),$(".index-widget-hotel .a-tel").on("click",function(e){var t=$(e.currentTarget),a=t.attr("data-tel");t&&a&&util.TelBox.showTb(a),e.stopPropagation()})},jump:function(e){helper.go(e,id)}}});