define("third:widget/helper/helper.js",function(require,exports,module){var util=require("common:static/js/util.js"),url=require("common:widget/url/url.js"),stat=require("common:widget/stat/stat.js"),searchData=require("common:static/js/searchdata.js"),broadcaster=require("common:widget/broadcaster/broadcaster.js"),locator=require("common:widget/geolocation/location.js");module.exports={cates:{cater:{wd:"美食",id:"cater",count:3,data:void 0},hotel:{wd:"快捷酒店",id:"hotel",count:2,data:void 0},bank:{wd:"银行",id:"bank",data:[{name:"工商银行",key:"icbc"},{name:"农业银行",key:"abc"},{name:"建设银行",key:"cbc"},{name:"中国银行",key:"bc"},{name:"ATM",key:"atm"}]}},thumbConfig:{host:"http://map.baidu.com/maps/services/thumbnails",imgWidth:180,imgHeight:135,oneStarW:15},getData:function(t,e,a){if(1==this.getCityCode())return this.cates[t].data=[],e&&e([]),void 0;a=a||{},this.cates[t].data=void 0,a.page&&"hao123"==a.page&&(this.cates.cater.count=6,this.cates.hotel.count=3);var r=this,o=this.cates[t].wd,n=this.getHash({query:{wd:o}}).query;searchData.fetch(util.jsonToQuery(n),function(a){var n=[];a&&a.content&&(n=r._formatData(o,a.content)),r.cates[t].data=n,e&&e(n)},function(){e&&e([])})},getHash:function(t){var e=t.module||"search",a=t.action||"search",r={qt:"s",wd:"",c:this.getCityCode()},o={};t.query?r=$.extend(r,t.query):(r.wd=t.wd||t.word||t.name,r.searchFlag="sort");var n=url.get(),i=n.query,c=n.pageState||{},s=c.from||"",l=decodeURIComponent(c.center_name||locator.getCity());switch("place"==e&&"takeout"==a&&(o.search="takeout",l=locator.hasExactPoi()?locator.isUserInput()?locator.getAddress():"我的位置":locator.getCity()),s){case"searchnearby":r.center_rank=1,r.nb_x=i.nb_x||c.nb_x,r.nb_y=i.nb_y||c.nb_y,o.from="searchnearby",o.type="searchnearby","place"==e&&"takeout"==a&&(l=decodeURIComponent(c.center_name));break;case"business":r.wd=c.bd+"     "+r.wd,"place"==e&&"takeout"==a&&locator.hasExactPoi()&&(r.center_rank=1,r.nb_x=locator.getPointX(),r.nb_y=locator.getPointY());break;default:locator.hasExactPoi()&&(l=locator.isUserInput()?locator.getAddress():"我的位置",r.center_rank=1,r.nb_x=locator.getPointX(),r.nb_y=locator.getPointY())}return o.center_name=l,"今夜特价"===r.wd&&(r.pl_tonight_sale_flag_section=1,r.pl_data_type="hotel"),{module:e,action:a,query:r,pageState:o}},ready:function(){this.cates.cater.data&&this.cates.hotel.data&&broadcaster.broadcast("nearpush.dataready")},go:function(evt,key){var target=$(evt.currentTarget);switch(target.attr("jsaction")){case key+"-detail":eval("var data = "+target.attr("userdata"));var uid=data.uid;stat.addCookieStat(STAT_CODE.STAT_NEARPUSH_DETAIL_CLICK,{id:data.id}),url.update({module:"place",action:"detail",query:{qt:"inf",uid:uid,c:this.getCityCode()}},{trigger:!0,queryReplace:!0});break;case key+"-all":eval("var data = "+target.attr("userdata"));var word=data.wd||this.cates[key].wd,hash=this.getHash({module:"search",action:"search",query:{wd:word}});stat.addCookieStat(STAT_CODE.STAT_NEARPUSH_ALL_CLICK,{id:data.id}),url.update({module:hash.module,action:hash.action,query:hash.query,pageState:hash.pageState},{trigger:!0,queryReplace:!0,pageStateReplace:!0})}return!1},getCityCode:function(){var t=url.get(),e=(t.query,t.pageState||{});return e.code&&1!=e.code?e.code:locator.getCityCode()||1},_formatData:function(t,e){var a=this;switch(t){case"美食":return a._formatDataCY(e);case"快捷酒店":return a._formatDataHotel(e)}},_formatDataCY:function(t){for(var e=this,a=this.cates.cater.count,r=[],o=[],n=0,i=t.length;i>n;n++){var c={};c.name=t[n].name,c.uid=t[n].uid;var s=void 0;if(void 0!=t[n].ext&&void 0!=t[n].ext.detail_info&&(s=!0,placeInfo=t[n].ext.detail_info),""!=placeInfo.image&&s){if(c.image=e._getImgSrc(placeInfo.image)||"",""!=placeInfo.groupon&&null!=placeInfo.groupon?c.otherflag='<em class="icon groupon-icon"></em>':""!=placeInfo.premium2&&0!=placeInfo.premium2&&null!=placeInfo.premium2&&(c.otherflag='<em class="icon sale-icon"></em>'),c.star=e._getStar(placeInfo.overall_rating)||"",c.comment=placeInfo.comment_num||"",r.push(c),r.length===a)return r}else o.push(c)}return r=r.concat(o.slice(0,a-r.length))},_formatDataHotel:function(t){for(var e=this,a=this.cates.hotel.count,r=[],o=[],n=0,i=t.length;i>n;n++){var c={};c.name=t[n].name,c.uid=t[n].uid,c.addr=t[n].addr;var s=void 0;if(void 0!=t[n].ext&&void 0!=t[n].ext.detail_info&&(s=!0,placeInfo=t[n].ext.detail_info),c.price=placeInfo.price||"",""!=t[n].image&&placeInfo&&""!=t[n].tel){if(c.image=e._getImgSrc(placeInfo.image)||"",c.star=e._getStar(placeInfo.overall_rating)||"",c.tel=e._getTel(t[n].tel)||{},placeInfo.uid=t[n].uid,c.order=e._getOrder(placeInfo),r.push(c),r.length===a)return r;o.push(c)}}return r=r.concat(o.slice(0,a-r.length))},visible:function(t,e,a){var r=$(t)[0],o=function(){var t=r.getBoundingClientRect().top,o=window.innerHeight;o>=t&&e&&(a?e.call(a):e())};o(),$(window).on("scroll",o)},_getTel:function(t){var e,a;return void 0==t||""==t?{}:(e=t.indexOf(",")>-1?t.split(","):t.split(";"),e=e[0].replace(/\(/gi,"").replace(/\)/gi,"-"),a=util.isAndroid()?'href="javascript:void(0);" data-tel="'+e+'"':'href="tel:'+e+'"',{url:a,num:e})},_getOrder:function(t){var e=t.hotel_ori_info,a=t.ota_url;if(""==e||0==e.length)return!1;for(var r=0,o=e.length,n=e[r];o>r;r++)if("qunar"==n.src&&"可预定酒店"==n.hotel_flag)for(var i=0,c=a.length,s=a[i];c>i;i++)if("qunar"==s.src)return!0},_getStar:function(t){if(t){var e=parseInt(10*t)/10*this.thumbConfig.oneStarW,a='<span class="star-box">                            <span class ="star-scroe" style = "width:#rate#px"></span>                    </span>'.replace("#rate#",e);return a}},_getImgSrc:function(t){if("string"!=typeof t||""==t)return F.uri("/static/img/no_img.png");var e=this.thumbConfig;t.indexOf("&nbsp;&nbsp;&nbsp;")>-1&&(t=$.trim(t.split("&nbsp;&nbsp;&nbsp;")[0])),t=t.replace("(","%28"),t=t.replace(")","%29");var a=e.host+"?width="+e.imgWidth+"&height="+e.imgHeight+"&src="+encodeURIComponent(t);return a}}});