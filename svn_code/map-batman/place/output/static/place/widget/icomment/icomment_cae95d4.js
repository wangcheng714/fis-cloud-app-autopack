define("place:widget/icomment/icomment.js",function(t,o,e){var s=t("common:widget/login/login.js"),n=t("common:widget/popup/popup.js"),i=t("common:widget/stat/stat.js");e.exports={msg:{netError:"发送失败请检查网络连接后重试",nocontentError:"评论内容不能为空"},$form:$("#J_addComment"),$scores:$("#J_impression li"),init:function(){this.$scores.on("click",$.proxy(this.switchScores,this)),$("#J_submitComment").on("click",$.proxy(this.submitComment,this))},switchScores:function(t){var o;(o=$(t.target).closest("li"))&&(this.$scores.removeClass("active"),o.addClass("active"))},submitComment:function(){var t=this,o=t._getContent(),e=t._getScore(),n=t.msg;i.addStat(STAT_CODE.PLACE_COMMENT_ICOMMENT_SUBMITCLICK),s.checkLogin(function(i){i.status?e&&o?$.ajax({type:"post",url:"/mobile/webapp/place/icomment/force=simple",data:{uid:t.$form.data("uid"),content:o,score:e},dataType:"json",success:function(o){t._addCommentSuccess(o)},error:function(){t.showMessage(n.netError)}}):t.showMessage(n.nocontentError):s.loginAction()})},_getScore:function(){return this.$form.find(".active").attr("value")},_getContent:function(){return $("#J_commentContent").val()},_addCommentSuccess:function(t){var o=this;0===parseInt(t.status)?(i.addStat(STAT_CODE.PLACE_COMMENT_ICOMMENT_SUBMITSUCCESS),o.showMessage(t.msg),setTimeout(function(){location.href=o.$form.data("url")},2e3)):o.showMessage(t.msg)},showMessage:function(t,o){n.open({text:t,autoCloseTime:o||2e3})}}});